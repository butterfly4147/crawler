# 分布式爬虫项目学习路线图（自顶向下）

本路线图结合你在 Go 游戏服务器的实践经验，按“架构 → 模块 → 分布式特性 → 实战与优化”的路径设计，帮助你从不熟悉到完全掌握。

## 阶段一：架构理解与环境搭建（2–3天）

### 目标
- 建立整体架构认知，跑通本地/容器化环境，理解启动链路。

### 建议阅读顺序
1. `docs/traegpt5/00_项目架构总览.md`
2. 代码：`main.go` → `cmd/cmd.go` → `cmd/master/master.go` → `cmd/worker/worker.go`
3. 配置与部署：`config.toml`、`docker-compose.yml`、`kubernetes/`

### 实践任务
- Docker 一键启动（或 Windows 手动启动）：Master、Worker、MySQL、etcd。
- 通过 HTTP/gRPC 添加 `example_baidu_home` 任务并在数据库验证结果。
- 使用 `etcdctl` 观察服务注册、资源与选举键变化。

## 阶段二：核心模块深入（3–4天）

### 目标
- 掌握 Master（选举/分配）、Engine（调度/并发/去重/重试）、Spider（规则树/上下文）。

### 建议阅读顺序
1. `docs/traegpt5/01_核心模块深度解析.md`
2. 代码：`master/master.go`、`engine/schedule.go`、`spider/*`、`parse/*`

### 实践任务
- 修改分配策略为“轮询 + 权重”，对 Worker 负载进行可视化日志输出。
- 为 Engine 增加并发度参数与失败退避重试策略（例：指数退避）。
- 编写一个最小爬虫规则（`parse/minimal`），增加字段抽取与数据清洗。

## 阶段三：分布式特性掌握（2–3天）

### 目标
- 深入理解 go-micro、etcd 的服务注册与发现、Leader 选举、故障转移。

### 建议阅读顺序
- 代码与文档：`master/master.go` 中选举相关方法，`proto/crawler/*` 通信定义。

### 实践任务
- 使用 `etcdctl watch --prefix /micro/registry/` 观察服务上下线。
- 模拟 Worker 故障并观察 Master 的容错与任务重分配行为。
- 为 Master 增加优雅关闭与恢复机制，确保任务状态一致性。

## 阶段四：实战项目与性能优化（3–5天）

### 目标
- 完成一个小型新闻站点聚合爬虫，覆盖多站点、增量更新、去重、监控告警。

### 实践任务
- 新增 `storage` 插件（如 Redis/文件），实现 `storage.Storage` 接口。
- 集成 `Prometheus` 暴露关键指标：请求速率、成功失败计数、队列长度等。
- 性能优化：对象池 `sync.Pool`、批量持久化、布隆过滤器、代理轮换与限速策略。

## 检查清单

### 阶段一
- [ ] 本地或容器化环境启动成功
- [ ] 能添加任务并在 MySQL 查看数据
- [ ] 会使用 `etcdctl` 观察服务注册与选举

### 阶段二
- [ ] 理解 Master 的选举与任务分配
- [ ] 掌握 Engine 调度与并发控制、去重重试
- [ ] 能编写并运行自定义 Spider 规则

### 阶段三
- [ ] 熟悉 go-micro 与 etcd 的注册发现与选举机制
- [ ] 能进行故障演练与恢复测试

### 阶段四
- [ ] 完成一个端到端实战项目
- [ ] 实施监控与性能优化策略
- [ ] 能扩展存储与解析能力

## 学习资源
- 官方：go-micro、etcd、gRPC Go 文档
- 开源：Colly、Scrapy、go-micro examples
- 书籍：分布式系统、Go 高级编程、微服务架构设计模式

## 建议节奏
- 第1周：跑通环境与基础任务
- 第2周：深入核心模块与编写规则
- 第3周：掌握分布式协调与容错
- 第4周：完成实战与优化、总结输出

完成本路线后，你应具备独立设计、实现与运维分布式爬虫系统的能力，并能类比到游戏服务器的分布式与高可用场景。