# 分布式爬虫项目快速上手指南（Windows & Docker）

本指南帮助你在约 30 分钟内完成环境搭建与首个任务运行，并掌握基础排障与监控。建议先阅读《00_项目架构总览.md》建立宏观认知。

## 环境要求
- 操作系统：Windows 11（当前环境）
- Go：1.19+（推荐 1.21+）
- MySQL：5.7+/8.0+
- etcd：3.5+
- Docker：20.10+（推荐）

## 一键启动（Docker 推荐）

### 步骤 1：克隆与检查
```powershell
git clone <项目地址>
cd crawler
type config.toml
type docker-compose.yml
```

### 步骤 2：启动服务
```powershell
docker-compose up -d
Start-Sleep -Seconds 30
docker-compose ps
```

### 步骤 3：健康检查
```powershell
curl http://localhost:8082/health  # Master
curl http://localhost:8080/health  # Worker
```

### 步骤 4：运行首个任务
```powershell
$body = @{ name = "example_baidu_home" } | ConvertTo-Json
Invoke-RestMethod -Uri "http://localhost:8082/crawler/resource" -Method POST -Body $body -ContentType "application/json"
Start-Sleep -Seconds 10

docker exec crawler-mysql-1 mysql -u root -p123456 -e "USE crawler; SHOW TABLES;"
docker exec crawler-mysql-1 mysql -u root -p123456 -e "USE crawler; SELECT * FROM example_baidu_home LIMIT 5;"
```

## 手动启动（深入理解推荐）

### 步骤 1：安装依赖
```powershell
# MySQL（可用 choco 或手动安装）
mysql -u root -p123456 -e "CREATE DATABASE IF NOT EXISTS crawler DEFAULT CHARSET utf8;"

# etcd（下载解压并加入 PATH）
etcd --version
```

### 步骤 2：编译与启动
```powershell
go mod download
go build -o crawler.exe .

# 终端 1：etcd
etcd --data-dir=default.etcd --listen-client-urls=http://127.0.0.1:2379 --advertise-client-urls=http://127.0.0.1:2379

# 终端 2：Master
.\crawler.exe master --id=2 --http=:8082 --grpc=:9092 --pprof=:9982

# 终端 3：Worker
.\crawler.exe worker --id=1 --http=:8080 --grpc=:9090
```

### 步骤 3：验证与观测
```powershell
curl http://localhost:8082/health
curl http://localhost:8080/health
etcdctl get --prefix /micro/registry/
etcdctl get --prefix /resources/
```

## 常见问题排查

### 启动失败（etcd 连接错误）
```powershell
netstat -an | findstr 2379
etcdctl endpoint health
```

### 数据库连接失败
```powershell
mysql -u root -p123456 -e "SELECT 1;"
type config.toml | findstr mysql
```

### 任务无数据
```powershell
curl http://localhost:8082/crawler/resource
docker logs crawler-worker-1 | Select-String "task"
etcdctl get --prefix /resources/
```

### 端口占用
```powershell
netstat -ano | findstr :8080
taskkill /F /PID <PID>
.\crawler.exe worker --id=1 --http=:8081 --grpc=:9091
```

## 性能与监控
```powershell
# 进程与资源
Get-Process -Name crawler | Select-Object CPU,WorkingSet

# 网络连接
netstat -an | findstr "8080\|8082\|9090\|9092"

# MySQL 连接
mysql -u root -p123456 -e "SHOW PROCESSLIST;"

# etcd 状态
etcdctl endpoint status --write-out=table
```

## 下一步建议
- 阅读：`docs/traegpt5/00_项目架构总览.md`、`docs/traegpt5/01_核心模块深度解析.md`
- 路线：`docs/traegpt5/02_学习路线图.md` 按阶段推进（先架构，后模块，再分布式，最后实战与优化）。

完成本指南后，你应能：
- 启动并验证一个完整的 Master–Worker 集群
- 添加并执行任务，在 MySQL 中查看结果
- 基本掌握故障排查与资源监控方法